# Custom Command: 37d-c3 - AI Image Generation Orchestrator

Orchestrator dla automatycznego generowania obrazów w ChatGPT z użyciem MCP TODOIT

UWAGA: Używaj MCP todoit i playwright-headless do automatyzacji

  Dane wejściowe:

  - Projekt: "[BOOK_FOLDER]" (np. "0001_alice_in_wonderland")
  - System używa MCP TODOIT do zarządzania zadaniami

  Identyfikacja folderu książki:

  // Jeśli podano nazwę książki zamiast folderu:
  ls /home/xai/DEV/37degrees/books/ żeby zidentyfikować folder
  
  // Przykład: "Alicja w Krainie Czarów" → znajduje folder "0001_alice_in_wonderland"
  // Użyj znalezionego folderu jako [BOOK_FOLDER] w dalszych krokach

  Kroki orchestratora:

  1. Inicjalizacja listy TODOIT

  // Utwórz listę TODOIT z nazwą BOOK_FOLDER
  mcp__todoit__todo_create_list(
    list_key: "[BOOK_FOLDER]",
    title: "AI Image Generation for [BOOK_FOLDER]",
    list_type: "sequential"
  )

  // Zapisz BOOK_FOLDER jako właściwość listy
  mcp__todoit__todo_set_list_property(
    list_key: "[BOOK_FOLDER]",
    property_key: "book_folder",
    property_value: "[BOOK_FOLDER]"
  )

  2. Dodanie zadań do listy

  // Znajdź wszystkie pliki YAML scen
  find /home/xai/DEV/37degrees/books/[BOOK_FOLDER]/prompts/genimage/ -name "scene_*.yaml" | sort

  // Dodaj każdy plik YAML jako zadanie do TODOIT
  // Format zadania: "Generate image using scene_XX.yaml"
  for each YAML_FILE in sorted order:
    mcp__todoit__todo_add_item(
      list_key: "[BOOK_FOLDER]",
      item_key: "scene_XX",
      content: "Generate image using scene_XX.yaml"
    )

  3. Wykonanie pojedynczego zadania

  // Sprawdź czy są pending zadania
  next_task = mcp__todoit__todo_get_next_pending(list_key: "[BOOK_FOLDER]")
  
  if (next_task exists):
    // Wywołaj subagent 37d-a3 z parametrem TODOIT_LIST - TYLKO RAZ
    Task(
      subagent_type: "37d-a3",
      description: "Generate single image",
      prompt: "Execute image generation for TODOIT_LIST: [BOOK_FOLDER]. Process one pending task and mark as completed."
    )
    
    // Sprawdź czy zadanie zostało poprawnie ukończone
    completed_task = mcp__todoit__todo_get_item(
      list_key: "[BOOK_FOLDER]",
      item_key: next_task.key
    )
    
    // Weryfikuj poprawność wykonania
    thread_id = mcp__todoit__todo_get_item_property(
      list_key: "[BOOK_FOLDER]",
      item_key: next_task.key,
      property_key: "thread_id"
    )
    
    if (completed_task.status == "completed" AND thread_id exists):
      echo "✅ Zadanie " + next_task.content + " ukończone poprawnie"
      echo "Thread ID: " + thread_id
    else:
      echo "❌ Błąd: Zadanie nie zostało ukończone poprawnie"
      echo "Status: " + completed_task.status
      echo "Thread ID: " + (thread_id ? thread_id : "BRAK")
  else:
    echo "ℹ️ Brak pending zadań w liście [BOOK_FOLDER]"

  4. Status końcowy

  // Pokaż postęp realizacji
  progress = mcp__todoit__todo_get_progress(list_key: "[BOOK_FOLDER]")
  
  // Raportuj aktualny stan
  echo "Status: " + progress.completed + "/" + progress.total + " zadań ukończone"

  Uwagi techniczne:

  - CRITICAL: Nazwa listy TODOIT MUSI być dokładnie taka sama jak [BOOK_FOLDER]
  - Jeśli podano nazwę książki zamiast folderu, użyj find/grep do identyfikacji folderu  
  - System TODOIT zastępuje TODO-GENERATE.md - wszystkie dane przechowywane w MCP
  - Subagent 37d-a3 otrzymuje tylko nazwę listy TODOIT, odczytuje BOOK_FOLDER z właściwości
  - CRITICAL: Orchestrator wywołuje agenta 37d-a3 TYLKO RAZ, nie w pętli
  - Orchestrator weryfikuje poprawność wykonania (status completed + thread_id)
  - Jeśli weryfikacja nie przejdzie, raportuje błąd
  
  Stan końcowy:
  
  - Lista TODOIT "[BOOK_FOLDER]" utworzona z wszystkimi zadaniami scene_XX.yaml
  - JEDNO zadanie przetworzone i zweryfikowane
  - PROJECT_ID zapisany w właściwościach listy (przy pierwszym wykonaniu)
  - Thread ID zapisany w właściwościach przetworzonego zadania
  - Raport o statusie wykonania i postępie ogólnym