# 37degrees Agent Workflow

This document defines the task-by-task workflow for individual 37d research agents.

<objective>
Execute research tasks from FILE TODO sequentially.
Generate comprehensive research report from collected data.
</objective>

<prerequisites>
VERIFY these conditions before starting:
1. EXECUTE Bash command: pwd (verify you are in books/NNNN_book_name directory)
2. VERIFY FILE TODO exists at docs/todo/TODO_37d-[agent-name].md
</prerequisites>

<workflow>

## STEP 1: Initialize Agent Session

<instructions>
1.1. DETERMINE agent name from FILE TODO filename
1.2. READ book.yaml to extract book metadata:
     - title
     - author  
     - year
1.3. CREATE search data directory if missing: docs/37d-[agent-name]/
</instructions>

<error-handling>
IF FILE TODO missing:
  REPORT: "ERROR: FILE TODO missing at docs/todo/TODO_37d-[agent-name].md"
  EXIT workflow

IF book.yaml missing:
  REPORT: "ERROR: book.yaml missing - cannot determine book metadata"
  EXIT workflow

IF docs/agents/ not accessible:
  REPORT: "ERROR: Cannot access agent documentation at docs/agents/ - verify symbolic link exists"
  EXIT workflow
</error-handling>

## STEP 2: Task Execution Loop

<instructions>
WHILE FILE TODO contains tasks marked [ ]:

2.1. READ FILE TODO and FIND first task marked [ ]
     
2.2. CONSTRUCT search query based on:
     - Task description
     - Book title and author
     - Specific aspect mentioned in task
     
2.3. EXECUTE WebSearch with constructed query
     Example: "Brave New World" Huxley 1932 "Polish translation" history

2.4. EVALUATE search results:
     IF results insufficient or too general:
       REFINE query with more specific terms
       EXECUTE additional WebSearch
       
2.5. UPDATE task status in FILE TODO:
     IF valuable results found:
       CHANGE: "- [ ] Task description"
       TO: "- [x] Task description (completed YYYY-MM-DD HH:MM)"
       
     IF no results after multiple attempts:
       CHANGE: "- [ ] Task description"  
       TO: "- [0] Task description (no results YYYY-MM-DD HH:MM)"

2.6. CONTINUE to next [ ] task
</instructions>

<search-strategy>
INITIAL SEARCH:
- Include book title + author + specific aspect
- Use quotes for exact phrases
- Add year if historically relevant

REFINEMENT STRATEGIES:
- Add synonyms or related terms
- Try different language if applicable (e.g., Polish terms)
- Search for academic sources specifically
- Look for primary sources or first-hand accounts

WHEN TO STOP:
- After 3-4 search attempts with variations
- When diminishing returns on new information
- When query becomes too broad or speculative
</search-strategy>

NOTE: The 37d-save-search.py hook automatically saves all WebSearch/WebFetch 
results to docs/37d-[agent-name]/ as timestamped JSON files.

## STEP 3: Generate Research Report

<instructions>
AFTER all tasks marked [x] or [0]:

3.1. VERIFY all tasks completed:
     COUNT remaining [ ] tasks
     IF any [ ] remain: RETURN to STEP 2
     
3.2. LOCATE all JSON files:
     PATH: docs/37d-[agent-name]/37d-[agent-name]_raw_*.json
     
3.3. READ research-report-prompt.md for synthesis instructions

3.4. PROCESS all JSON files to extract:
     - Search queries (tool_input.query)  
     - Search results (tool_response.results)
     - Connections between searches
     
3.5. SYNTHESIZE findings following research-report-prompt.md structure:
     - Group by themes (not by task order)
     - Create narrative flow
     - Include all sources and citations
     
3.6. WRITE comprehensive report to:
     docs/findings/37d-[agent-name]_findings.md
</instructions>

## STEP 4: Finalize

<instructions>
4.1. VERIFY deliverables exist:
     - All tasks in FILE TODO marked [x] or [0]
     - JSON files in docs/37d-[agent-name]/
     - Research report in docs/findings/

4.2. REPORT completion:
     "Research completed. [X] tasks successful, [Y] tasks with no results.
      Research report generated at docs/findings/37d-[agent-name]_findings.md"
</instructions>

</workflow>

<context>

## Task Status Progression
```
- [ ] Task description                    # Not started
- [x] Task description (completed DATE)   # Completed with results
- [0] Task description (no results DATE)  # Completed without results
```

Note: No [R] running status - tasks go directly from [ ] to [x] or [0]

## File Locations
- Input: docs/todo/TODO_37d-[agent-name].md
- Search data: docs/37d-[agent-name]/*.json (auto-saved by hook)
- Output: docs/findings/37d-[agent-name]_findings.md
- Synthesis guide: docs/agents/research-report-prompt.md

</context>

<examples>

## Example 1: Task Execution
```
Agent: Reading FILE TODO...
Agent: Found task "Research Polish translations and translators"
Agent: Searching: "Brave New World" "Nowy wspaniały świat" Polish translation history
Agent: Found relevant results about Huxley translations
Agent: Task marked [x] with timestamp
Agent: Moving to next task...
```

## Example 2: Multiple Search Attempts
```
Agent: Found task "Analyze key concepts translation to Polish"
Agent: Searching: "Brave New World" Polish translation "soma" "feelies" terminology
Agent: Limited results, refining search...
Agent: Searching: "Nowy wspaniały świat" Huxley Polish "soma" translation choices
Agent: Found detailed analysis of translation decisions
Agent: Task marked [x] with timestamp
```

## Example 3: No Results
```
Agent: Found task "Find unpublished Polish dissertations"
Agent: Searching: "Brave New World" Polish unpublished dissertation manuscript
Agent: No results found, trying broader search...
Agent: Searching: Huxley Polish academic thesis unpublished  
Agent: Still no relevant results after 3 attempts
Agent: Task marked [0] with timestamp
```

</examples>

<important-notes>

1. **Simple Status**: Only [ ] → [x] or [ ] → [0], no intermediate states
2. **Multiple Searches**: Can search multiple times per task for better results
3. **Automatic Saving**: All searches auto-saved as JSON by system hook
4. **Final Synthesis**: Report generation happens AFTER all tasks complete
5. **Follow Synthesis Guide**: Use research-report-prompt.md for report structure

</important-notes>