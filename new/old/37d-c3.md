# Custom Command: 37d-c3 - AI Image Generation Orchestrator

Orchestrator dla automatycznego generowania obraz√≥w w ChatGPT z u≈ºyciem MCP TODOIT

UWAGA: U≈ºywaj MCP todoit i playwright-headless do automatyzacji

  Dane wej≈õciowe:

  - Projekt: "[BOOK_FOLDER]" (np. "0001_alice_in_wonderland")
  - System u≈ºywa MCP TODOIT do zarzƒÖdzania zadaniami  
  - [TODOIT_LIST] matakƒÖ samƒÖ¬†nazwƒô jak [BOOK_FOLDER]

  Kroki orchestratora:

  1. Wykonanie pojedynczego zadania

  // Sprawd≈∫ czy sƒÖ pending zadania
  next_task = mcp__todoit__todo_get_next_pending(list_key: "[BOOK_FOLDER]")
  
  if (next_task exists):
    // Wywo≈Çaj subagent 37d-a3 z parametrem TODOIT_LIST - TYLKO RAZ
    Task(
      subagent_type: "37d-a3",
      description: "Generate single image",
      prompt: "Execute image generation for TODOIT_LIST: [BOOK_FOLDER]. Process one pending task and mark as completed."
    )
    
    // Sprawd≈∫ czy zadanie zosta≈Ço poprawnie uko≈Ñczone
    completed_task = mcp__todoit__todo_get_item(
      list_key: "[BOOK_FOLDER]",
      item_key: next_task.key
    )
    
    // Weryfikuj poprawno≈õƒá wykonania
    thread_id = mcp__todoit__todo_get_item_property(
      list_key: "[BOOK_FOLDER]",
      item_key: next_task.key,
      property_key: "thread_id"
    )
    
    if (completed_task.status == "completed" AND thread_id exists):
      echo "‚úÖ Zadanie " + next_task.content + " uko≈Ñczone poprawnie"
      echo "Thread ID: " + thread_id
    else:
      // Sprawd≈∫ czy to b≈ÇƒÖd ChatGPT daily limit
      error_message = mcp__todoit__todo_get_item_property(
        list_key: "[BOOK_FOLDER]",
        item_key: next_task.key,
        property_key: "ERROR"
      )
      
      // Je≈õli ERROR zawiera komunikaty o limicie ChatGPT - wys≈Çaj sygna≈Ç stop
      if (error_message.success AND 
          (error_message.property_value contains "You've hit the plus plan limit" OR
           error_message.property_value contains "daily usage limit reached" OR
           error_message.property_value contains "Create image feature is disabled" OR
           error_message.property_value contains "limit resets in")):
        
        echo "üö´ CHATGPT_DAILY_LIMIT_REACHED"
        echo "Szczeg√≥≈Çy: " + error_message.property_value
        echo "Thread ID: " + (thread_id ? thread_id : "BRAK")
        // CRITICAL: Zako≈Ñcz orchestrator - todoit.sh wykryje sygna≈Ç i zatrzyma skrypt
        return
      else:
        echo "‚ùå B≈ÇƒÖd: Zadanie nie zosta≈Ço uko≈Ñczone poprawnie"
        echo "Status: " + completed_task.status
        echo "Thread ID: " + (thread_id ? thread_id : "BRAK")
  else:
    echo "‚ÑπÔ∏è Brak pending zada≈Ñ w li≈õcie [BOOK_FOLDER]"

  2. Status ko≈Ñcowy

  // Poka≈º postƒôp realizacji
  progress = mcp__todoit__todo_get_progress(list_key: "[BOOK_FOLDER]")
  
  // Raportuj aktualny stan
  echo "Status: " + progress.completed + "/" + progress.total + " zada≈Ñ uko≈Ñczone"

  Uwagi techniczne:

  - CRITICAL: Lista TODOIT musi byƒá utworzona wcze≈õniej przez 37d-c2 (Style Applicator)
  - CRITICAL: Nazwa listy TODOIT MUSI byƒá dok≈Çadnie taka sama jak [BOOK_FOLDER]
  - Je≈õli podano nazwƒô ksiƒÖ≈ºki zamiast folderu, u≈ºyj find/grep do identyfikacji folderu  
  - System TODOIT zastƒôpuje TODO-GENERATE.md - wszystkie dane przechowywane w MCP
  - Subagent 37d-a3 otrzymuje tylko nazwƒô listy TODOIT, odczytuje BOOK_FOLDER z w≈Ça≈õciwo≈õci
  - CRITICAL: Orchestrator wywo≈Çuje agenta 37d-a3 TYLKO RAZ, nie w pƒôtli
  - Orchestrator weryfikuje poprawno≈õƒá wykonania (status completed + thread_id)
  - Je≈õli weryfikacja nie przejdzie, raportuje b≈ÇƒÖd
  
  Stan ko≈Ñcowy:
  
  - Lista TODOIT "[BOOK_FOLDER]" ju≈º istniejƒÖca (utworzona przez 37d-c2)
  - JEDNO zadanie przetworzone i zweryfikowane
  - PROJECT_ID zapisany w w≈Ça≈õciwo≈õciach listy (przy pierwszym wykonaniu)
  - Thread ID zapisany w w≈Ça≈õciwo≈õciach przetworzonego zadania
  - Raport o statusie wykonania i postƒôpie og√≥lnym